(this["webpackJsonpsupabase-react"]=this["webpackJsonpsupabase-react"]||[]).push([[0],{187:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(27),i=n.n(c),s=(n(70),n(26)),u=n(2),l=n.n(u),o=n(16),j=n(8),b=n(15),d=n(188),p=n(89),O=Object(p.a)("https://yqgetgajqpwpsffdtbud.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzMzgxMjUyMSwiZXhwIjoxOTQ5Mzg4NTIxfQ.zpyM04YwEMXAGWxZUJoI28kscqEWLgWICBhnvM0559E"),h="/pay",x="/reservations",f="/account",v="/check",y=n(6),m=n(4),g=["type","children"];function w(e){var t=e.type,n=e.children,r=Object(y.a)(e,g);return"admin"===t?Object(m.jsx)(b.b,Object(s.a)(Object(s.a)({},r),{},{children:n})):Object(m.jsx)(b.a,{to:x})}var k=["type","children"];function C(e){var t=e.type,n=e.children,r=Object(y.a)(e,k);return"user"===t?Object(m.jsx)(b.b,Object(s.a)(Object(s.a)({},r),{},{children:n})):Object(m.jsx)(b.a,{to:x})}var S=n(202),I=n(51),D=n(203),T=n(204);function E(e){var t=e.session;return Object(m.jsxs)("header",{id:"header",border:"default",children:[Object(m.jsx)(S.a,{flex:1,children:"SupaParking"}),t&&t.isCreated?Object(m.jsx)(I.a,{onClick:function(){O.auth.signOut().then((function(){window.location.reload()}))},iconAfter:D.a,children:"Log Out"}):Object(m.jsx)(I.a,{iconAfter:T.a,children:"Log In"})]})}var M=n(37);function H(e){var t=e.type;return Object(m.jsxs)("nav",{children:["user"===t?Object(m.jsx)(M.b,{to:h,children:Object(m.jsx)(I.a,{children:"Pay"})}):null,"admin"===t?Object(m.jsx)(M.b,{to:v,children:Object(m.jsx)(I.a,{children:"Check"})}):null,Object(m.jsx)(M.b,{to:x,children:Object(m.jsx)(I.a,{children:"Reservations"})}),Object(m.jsx)(M.b,{to:f,children:Object(m.jsx)(I.a,{children:"Account"})})]})}var q=n(221),L=n(223),_="profiles",B=function(){var e=Object(o.a)(l.a.mark((function e(){var t,n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=O.auth.user()){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,O.from(_).select("type").eq("id",t.id).single();case 5:return n=e.sent,r=n.data,a=n.error,c=n.status,e.abrupt("return",{data:r,error:a,status:c});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=Object(o.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=O.auth.user(),r=[{id:n.id,type:t}],e.abrupt("return",O.from(_).insert(r,{returning:"minimal"}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function P(){var e=Object(r.useState)(!1),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),i=Object(j.a)(c,2),s=i[0],u=i[1],b=Object(r.useState)("user"),d=Object(j.a)(b,2),p=d[0],h=d[1];Object(r.useEffect)((function(){var e=O.auth.user();u(e.email)}),[]);var x=function(){var e=Object(o.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a(!0),e.next=4,F(t);case 4:if(n=e.sent,!(r=n.error)){e.next=8;break}throw r;case 8:a(!1),window.location.reload(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),alert(e.t0.error_description||e.t0.message);case 15:return e.prev=15,a(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,12,15,18]])})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsxs)("form",{children:[Object(m.jsx)(q.a,{id:"email",label:"Email",required:!0,type:"email",placeholder:"Your email",value:s,disabled:!0}),Object(m.jsxs)(L.a,{label:"Account type",required:!0,value:p,onChange:function(e){return h(e.target.value)},children:[Object(m.jsx)("option",{value:"user",children:"User"}),Object(m.jsx)("option",{value:"admin",children:"Admin"})]}),Object(m.jsx)(I.a,{isLoading:n,onClick:function(e){e.preventDefault(),x(p)},children:"Continue"})]})}var R=n(220),A=n(67),J=n(68);function z(){var e=Object(r.useState)(!1),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),i=Object(j.a)(c,2),s=i[0],u=i[1],b=function(){var e=Object(o.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a(!0),e.next=4,O.auth.signIn({email:t});case 4:if(n=e.sent,!(r=n.error)){e.next=8;break}throw r;case 8:R.a.notify("Check your email for the login link!"),u(""),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),alert(e.t0.error_description||e.t0.message);case 15:return e.prev=15,a(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,12,15,18]])})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsxs)(A.a,{padding:40,children:[Object(m.jsx)(S.a,{children:"Supabase + React"}),Object(m.jsx)(J.a,{children:"Sign in via magic link with your email below"}),Object(m.jsx)(q.a,{id:"email",label:"Email",required:!0,type:"email",placeholder:"Your email",value:s,onChange:function(e){return u(e.target.value)}}),Object(m.jsx)(I.a,{isLoading:n,onClick:function(e){e.preventDefault(),b(s)},children:"Send magic link"})]})}var U=n(212);function Y(e){var t=e.session,n=Object(r.useState)(!0),a=Object(j.a)(n,2),c=(a[0],a[1]),i=Object(r.useState)(null),s=Object(j.a)(i,2),u=s[0],b=s[1],d=Object(r.useState)(null),p=Object(j.a)(d,2),h=p[0],x=p[1],f=Object(r.useState)(null),v=Object(j.a)(f,2),y=v[0],g=v[1];function w(){return(w=Object(o.a)(l.a.mark((function e(){var t,n,r,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c(!0),t=O.auth.user(),b(t.email),e.next=6,O.from("profiles").select("*").eq("id",t.id).single();case 6:if(n=e.sent,r=n.data,a=n.error,i=n.status,!a||406===i){e.next=12;break}throw a;case 12:r&&(x(r.type),g(r.created_at)),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),alert(e.t0.message);case 18:return e.prev=18,c(!1),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[0,15,18,21]])})))).apply(this,arguments)}return Object(r.useEffect)((function(){!function(){w.apply(this,arguments)}()}),[t]),Object(m.jsxs)(U.a,{children:[Object(m.jsxs)(S.a,{children:["Email: ",u]}),Object(m.jsxs)(S.a,{children:["Type: ",h]}),Object(m.jsxs)(S.a,{children:["Created at: ",y]})]})}var X=n(90),W="reservations",N=function(){var e=Object(o.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.from(W).select("*").eq("license_plate",t).gt("expiry",(new Date).toISOString());case 2:return n=e.sent,e.abrupt("return",!n.length);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=Object(o.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.from(W).select("*").lt("expiry",(new Date).toISOString());case 2:return t=e.sent,console.log(t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=Object(o.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.from(W).select("*").gt("expiry",(new Date).toISOString());case 2:return t=e.sent,console.log(t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Z=function(e){var t=O.auth.user(),n=[Object(s.a)({user_id:t.id},e)];return O.from(W).insert(n)};function V(){var e=Object(r.useState)(!1),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),i=Object(j.a)(c,2),s=i[0],u=i[1],b=Object(r.useState)(null),d=Object(j.a)(b,2),p=d[0],O=d[1],h=function(){var e=Object(o.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a(!0),s){e.next=5;break}return R.a.warning("Please enter a license plate."),e.abrupt("return");case 5:return e.next=7,N(s);case 7:t=e.sent,console.log("isReservationExpired",t),O(t),u("");case 11:return e.prev=11,a(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,,11,14]])})));return function(){return e.apply(this,arguments)}}();return Object(m.jsxs)(A.a,{display:"flex",flexDirection:"column",gap:8,width:400,children:[Object(m.jsx)(q.a,{id:"license-plate",type:"text",required:!0,label:"License plate",placeholder:"Enter license plate",value:s,onChange:function(e){return u(e.target.value)},marginBottom:0}),Object(m.jsx)(I.a,{isLoading:n,onClick:function(e){e.preventDefault(),h()},children:"Check"}),n||null===p?"Enter a license plate.":p?Object(m.jsx)(X.a,{intent:"success",title:"".concat(s," is valid."),marginBottom:32}):Object(m.jsx)(X.a,{intent:"danger",title:"".concat(s," has expired.")})]})}var K=n(214),$=n(217),ee=n(213),te=new Date;function ne(){var e,t=Object(r.useState)(!1),n=Object(j.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)(""),s=Object(j.a)(i,2),u=s[0],b=s[1],d=Object(r.useState)(1),p=Object(j.a)(d,2),O=p[0],h=p[1],x=Object(r.useState)(te),f=Object(j.a)(x,2),v=f[0],y=f[1],g=function(){var e=Object(o.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,c(!0),u){e.next=5;break}return R.a.warning("Please enter a license plate."),e.abrupt("return");case 5:return t={license_plate:u,expiry:v.toISOString()},console.log(t),e.next=9,Z(t);case 9:if(n=e.sent,!(r=n.error)){e.next=13;break}throw r;case 13:R.a.success("You have paid for the parking spot."),b(""),h(1),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),alert(e.t0.error_description||e.t0.message);case 21:return e.prev=21,c(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[0,18,21,24]])})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){!function(){var e=Object(ee.a)(te,5*O);y(e)}()}),[O]),Object(m.jsxs)(U.a,{backgroundColor:"#F3F6FF",elevation:1,borderRadius:4,marginX:16,padding:24,display:"flex",flexDirection:"column",alignItems:"center",gap:24,children:[Object(m.jsx)(q.a,{id:"license-plate",type:"text",required:!0,label:"License plate",placeholder:"Enter license plate",value:u,onChange:function(e){return b(e.target.value)},marginBottom:0}),Object(m.jsx)(K.a,{children:(e=v,"Park until ".concat(Object($.a)(e,"HH:mm (dd/MM/yyyy)")))}),Object(m.jsxs)(U.a,{display:"flex",gap:"10px",children:[Object(m.jsx)(I.a,{onClick:function(){return h(1)},children:"\ud83d\udd04"}),Object(m.jsx)(I.a,{onClick:function(){O>1&&h(O-1)},children:"\u2796"}),Object(m.jsx)(S.a,{size:800,children:"in ".concat(5*O," minutes")}),Object(m.jsx)(I.a,{onClick:function(){return h(O+1)},children:"\u2795"})]}),Object(m.jsxs)(I.a,{height:48,isLoading:a,onClick:function(e){e.preventDefault(),g()},gap:8,children:["Pay",Object(m.jsx)("span",{children:"\ud83e\udd11"})]})]})}var re=n(216),ae=n(218),ce=n(215);function ie(){var e=Object(r.useState)([]),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)([]),i=Object(j.a)(c,2),s=i[0],u=i[1];return Object(r.useEffect)((function(){var e=function(){var e=Object(o.a)(l.a.mark((function e(){var t,n,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G();case 2:return t=e.sent,n=t.data,a(n),e.next=7,Q();case 7:r=e.sent,c=r.data,u(c);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]),Object(m.jsxs)(A.a,{paddingX:16,children:[Object(m.jsxs)(re.a,{children:[Object(m.jsxs)(re.a.Head,{children:[Object(m.jsx)(re.a.TextHeaderCell,{children:"Plate"}),Object(m.jsx)(re.a.TextHeaderCell,{children:"Remaining time"}),Object(m.jsx)(re.a.TextHeaderCell,{children:"Expires"})]}),Object(m.jsx)(re.a.Body,{height:240,children:s.map((function(e){return Object(m.jsxs)(re.a.Row,{children:[Object(m.jsx)(re.a.TextCell,{children:e.license_plate}),Object(m.jsx)(re.a.TextCell,{children:Object(ae.a)(new Date(e.expiry),{addSuffix:!0})}),Object(m.jsx)(re.a.TextCell,{children:Object($.a)(new Date(e.expiry),"dd/MM/yyyy HH:mm")})]},e.id)}))})]}),Object(m.jsxs)(re.a,{children:[Object(m.jsxs)(re.a.Head,{children:[Object(m.jsx)(re.a.TextHeaderCell,{children:"Plate"}),Object(m.jsx)(re.a.TextHeaderCell,{children:"Duration"}),Object(m.jsx)(re.a.TextHeaderCell,{children:"Start"}),Object(m.jsx)(re.a.TextHeaderCell,{children:"End"})]}),Object(m.jsx)(re.a.Body,{height:240,children:n.map((function(e){return Object(m.jsxs)(re.a.Row,{children:[Object(m.jsx)(re.a.TextCell,{children:e.license_plate}),Object(m.jsx)(re.a.TextCell,{children:Object(ce.a)(new Date(e.created_at),new Date(e.expiry),{roundingMethod:"ceil"})}),Object(m.jsx)(re.a.TextCell,{children:Object($.a)(new Date(e.created_at),"dd/MM/yyyy HH:mm")}),Object(m.jsx)(re.a.TextCell,{children:Object($.a)(new Date(e.expiry),"dd/MM/yyyy HH:mm")})]},e.id)}))})]})]})}function se(){var e=Object(r.useState)(!0),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(null),i=Object(j.a)(c,2),u=i[0],p=i[1];return Object(r.useEffect)((function(){function e(){return t.apply(this,arguments)}function t(){return t=Object(o.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B().then((function(e){if(e){var t=e.data,n=e.error,r=e.status,a=t&&!n&&200===r;console.log(a?"User exists in DB.":"User does not exist in DB.");var c=Object(s.a)(Object(s.a)({},O.auth.session()),{},{isCreated:a,type:t.type});p(c)}})).finally((function(){a(!1)}));case 1:case"end":return e.stop()}}),e)}))),t.apply(this,arguments)}e(),O.auth.onAuthStateChange(function(){var t=Object(o.a)(l.a.mark((function t(n,r){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e();case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}),[]),n?Object(m.jsx)(d.a,{}):Object(m.jsx)(m.Fragment,{children:u?u.isCreated?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(E,{session:u}),Object(m.jsxs)("div",{className:"container",children:[Object(m.jsx)(H,{type:u.type}),Object(m.jsx)("main",{children:Object(m.jsxs)(b.d,{children:[Object(m.jsx)(C,{type:u.type,path:h,exact:!0,children:Object(m.jsx)(ne,{})}),Object(m.jsx)(w,{type:u.type,path:v,exact:!0,children:Object(m.jsx)(V,{})}),Object(m.jsx)(b.b,{path:x,exact:!0,children:Object(m.jsx)(ie,{})}),Object(m.jsx)(b.b,{path:f,exact:!0,children:Object(m.jsx)(Y,{session:u})}),Object(m.jsx)(b.a,{to:x})]})})]})]}):Object(m.jsx)(P,{}):Object(m.jsx)(z,{})})}var ue=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,224)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};i.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(M.a,{basename:"/",children:Object(m.jsx)(se,{})})}),document.getElementById("root")),ue()},70:function(e,t,n){}},[[187,1,2]]]);
//# sourceMappingURL=main.d290a457.chunk.js.map