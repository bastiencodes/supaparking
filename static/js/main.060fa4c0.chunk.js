(this["webpackJsonpsupabase-react"]=this["webpackJsonpsupabase-react"]||[]).push([[0],{186:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(26),i=n.n(c),s=(n(70),n(46)),u=n(2),l=n.n(u),o=n(16),j=n(8),b=n(15),d=n(187),x="/reservations",h="/account",O=n(89),p=Object(O.a)("https://yqgetgajqpwpsffdtbud.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzMzgxMjUyMSwiZXhwIjoxOTQ5Mzg4NTIxfQ.zpyM04YwEMXAGWxZUJoI28kscqEWLgWICBhnvM0559E"),f=n(201),v=n(51),m=n(202),g=n(203),y=n(5);function w(e){var t=e.session;return Object(y.jsxs)("header",{id:"header",border:"default",children:[Object(y.jsx)(f.a,{flex:1,children:"SupaParking"}),t&&t.isCreated?Object(y.jsx)(v.a,{onClick:function(){return p.auth.signOut()},iconAfter:m.a,children:"Log Out"}):Object(y.jsx)(v.a,{iconAfter:g.a,children:"Log In"})]})}var k=n(37);function C(){return Object(y.jsxs)("nav",{children:[Object(y.jsx)(k.b,{to:"/",children:Object(y.jsx)(v.a,{children:"Pay"})}),Object(y.jsx)(k.b,{to:x,children:Object(y.jsx)(v.a,{children:"Reservations"})}),Object(y.jsx)(k.b,{to:h,children:Object(y.jsx)(v.a,{children:"Account"})})]})}var S=n(220),I=n(222),T="profiles",M=function(){var e=Object(o.a)(l.a.mark((function e(){var t,n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=p.auth.user()){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,p.from(T).select("id").eq("id",t.id).single();case 5:return n=e.sent,r=n.data,a=n.error,c=n.status,e.abrupt("return",{data:r,error:a,status:c});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=Object(o.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.auth.user(),r=[{id:n.id,type:t}],e.abrupt("return",p.from(T).insert(r,{returning:"minimal"}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function H(){var e=Object(r.useState)(!1),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),i=Object(j.a)(c,2),s=i[0],u=i[1],b=Object(r.useState)("user"),d=Object(j.a)(b,2),x=d[0],h=d[1];Object(r.useEffect)((function(){var e=p.auth.user();u(e.email)}),[]);var O=function(){var e=Object(o.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a(!0),e.next=4,D(t);case 4:if(n=e.sent,!(r=n.error)){e.next=8;break}throw r;case 8:a(!1),window.location.reload(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),alert(e.t0.error_description||e.t0.message);case 15:return e.prev=15,a(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,12,15,18]])})));return function(t){return e.apply(this,arguments)}}();return Object(y.jsxs)("form",{children:[Object(y.jsx)(S.a,{id:"email",label:"Email",required:!0,type:"email",placeholder:"Your email",value:s,disabled:!0}),Object(y.jsxs)(I.a,{label:"Account type",required:!0,value:x,onChange:function(e){return h(e.target.value)},children:[Object(y.jsx)("option",{value:"user",children:"User"}),Object(y.jsx)("option",{value:"admin",children:"Admin"})]}),Object(y.jsx)(v.a,{isLoading:n,onClick:function(e){e.preventDefault(),O(x)},children:"Continue"})]})}var E=n(217),F=n(67),_=n(68);function q(){var e=Object(r.useState)(!1),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),i=Object(j.a)(c,2),s=i[0],u=i[1],b=function(){var e=Object(o.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a(!0),e.next=4,p.auth.signIn({email:t});case 4:if(n=e.sent,!(r=n.error)){e.next=8;break}throw r;case 8:E.a.notify("Check your email for the login link!"),u(""),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),alert(e.t0.error_description||e.t0.message);case 15:return e.prev=15,a(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,12,15,18]])})));return function(t){return e.apply(this,arguments)}}();return Object(y.jsxs)(F.a,{padding:40,children:[Object(y.jsx)(f.a,{children:"Supabase + React"}),Object(y.jsx)(_.a,{children:"Sign in via magic link with your email below"}),Object(y.jsx)(S.a,{id:"email",label:"Email",required:!0,type:"email",placeholder:"Your email",value:s,onChange:function(e){return u(e.target.value)}}),Object(y.jsx)(v.a,{isLoading:n,onClick:function(e){e.preventDefault(),b(s)},children:"Send magic link"})]})}var L=n(211);function P(e){var t=e.session,n=Object(r.useState)(!0),a=Object(j.a)(n,2),c=(a[0],a[1]),i=Object(r.useState)(null),s=Object(j.a)(i,2),u=s[0],b=s[1],d=Object(r.useState)(null),x=Object(j.a)(d,2),h=x[0],O=x[1];function v(){return(v=Object(o.a)(l.a.mark((function e(){var t,n,r,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c(!0),t=p.auth.user(),b(t.email),e.next=6,p.from("profiles").select("*").eq("id",t.id).single();case 6:if(n=e.sent,r=n.data,a=n.error,i=n.status,!a||406===i){e.next=12;break}throw a;case 12:r&&O(r.created_at),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),alert(e.t0.message);case 18:return e.prev=18,c(!1),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[0,15,18,21]])})))).apply(this,arguments)}return Object(r.useEffect)((function(){!function(){v.apply(this,arguments)}()}),[t]),Object(y.jsxs)(L.a,{children:[Object(y.jsxs)(f.a,{children:["Email: ",u]}),Object(y.jsxs)(f.a,{children:["Created at: ",h]})]})}var B=n(213),A=n(216),J=n(212),R="reservations",z=function(){var e=Object(o.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.from(R).select("*").lt("expiry",(new Date).toISOString());case 2:return t=e.sent,console.log(t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=Object(o.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.from(R).select("*").gt("expiry",(new Date).toISOString());case 2:return t=e.sent,console.log(t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Y=function(e){var t=p.auth.user(),n=[Object(s.a)({user_id:t.id},e)];return p.from(R).insert(n)},X=new Date;function W(){var e,t=Object(r.useState)(!1),n=Object(j.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)(""),s=Object(j.a)(i,2),u=s[0],b=s[1],d=Object(r.useState)(1),x=Object(j.a)(d,2),h=x[0],O=x[1],p=Object(r.useState)(X),m=Object(j.a)(p,2),g=m[0],w=m[1],k=function(){var e=Object(o.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,c(!0),u){e.next=5;break}return E.a.warning("Please enter a license plate."),e.abrupt("return");case 5:return t={license_plate:u,expiry:g.toISOString()},console.log(t),e.next=9,Y(t);case 9:if(n=e.sent,!(r=n.error)){e.next=13;break}throw r;case 13:E.a.success("You have paid for the parking spot."),b(""),O(1),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),alert(e.t0.error_description||e.t0.message);case 21:return e.prev=21,c(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[0,18,21,24]])})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){!function(){var e=Object(J.a)(X,5*h);w(e)}()}),[h]),Object(y.jsxs)(L.a,{backgroundColor:"#F3F6FF",elevation:1,borderRadius:4,marginX:16,padding:24,display:"flex",flexDirection:"column",alignItems:"center",gap:24,children:[Object(y.jsx)(S.a,{id:"license-plate",type:"text",required:!0,label:"License plate",placeholder:"Enter license plate",value:u,onChange:function(e){return b(e.target.value)},marginBottom:0}),Object(y.jsx)(B.a,{children:(e=g,"Park until ".concat(Object(A.a)(e,"HH:mm (dd/MM/yyyy)")))}),Object(y.jsxs)(L.a,{display:"flex",gap:"10px",children:[Object(y.jsx)(v.a,{onClick:function(){return O(1)},children:"\ud83d\udd04"}),Object(y.jsx)(v.a,{onClick:function(){h>1&&O(h-1)},children:"\u2796"}),Object(y.jsx)(f.a,{size:800,children:"in ".concat(5*h," minutes")}),Object(y.jsx)(v.a,{onClick:function(){return O(h+1)},children:"\u2795"})]}),Object(y.jsxs)(v.a,{height:48,isLoading:a,onClick:function(e){e.preventDefault(),k()},gap:8,children:["Pay",Object(y.jsx)("span",{children:"\ud83e\udd11"})]})]})}var N=n(215),G=n(218),Q=n(214);function Z(){var e=Object(r.useState)([]),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)([]),i=Object(j.a)(c,2),s=i[0],u=i[1];return Object(r.useEffect)((function(){var e=function(){var e=Object(o.a)(l.a.mark((function e(){var t,n,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z();case 2:return t=e.sent,n=t.data,a(n),e.next=7,U();case 7:r=e.sent,c=r.data,u(c);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]),Object(y.jsxs)(F.a,{paddingX:16,children:[Object(y.jsxs)(N.a,{children:[Object(y.jsxs)(N.a.Head,{children:[Object(y.jsx)(N.a.TextHeaderCell,{children:"Plate"}),Object(y.jsx)(N.a.TextHeaderCell,{children:"Remaining time"}),Object(y.jsx)(N.a.TextHeaderCell,{children:"Expires"})]}),Object(y.jsx)(N.a.Body,{height:240,children:s.map((function(e){return Object(y.jsxs)(N.a.Row,{children:[Object(y.jsx)(N.a.TextCell,{children:e.license_plate}),Object(y.jsx)(N.a.TextCell,{children:Object(G.a)(new Date(e.expiry),{addSuffix:!0})}),Object(y.jsx)(N.a.TextCell,{children:Object(A.a)(new Date(e.expiry),"dd/MM/yyyy HH:mm")})]},e.id)}))})]}),Object(y.jsxs)(N.a,{children:[Object(y.jsxs)(N.a.Head,{children:[Object(y.jsx)(N.a.TextHeaderCell,{children:"Plate"}),Object(y.jsx)(N.a.TextHeaderCell,{children:"Duration"}),Object(y.jsx)(N.a.TextHeaderCell,{children:"Start"}),Object(y.jsx)(N.a.TextHeaderCell,{children:"End"})]}),Object(y.jsx)(N.a.Body,{height:240,children:n.map((function(e){return Object(y.jsxs)(N.a.Row,{children:[Object(y.jsx)(N.a.TextCell,{children:e.license_plate}),Object(y.jsx)(N.a.TextCell,{children:Object(Q.a)(new Date(e.created_at),new Date(e.expiry),{roundingMethod:"ceil"})}),Object(y.jsx)(N.a.TextCell,{children:Object(A.a)(new Date(e.created_at),"dd/MM/yyyy HH:mm")}),Object(y.jsx)(N.a.TextCell,{children:Object(A.a)(new Date(e.expiry),"dd/MM/yyyy HH:mm")})]},e.id)}))})]})]})}function V(){var e=Object(r.useState)(!0),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(null),i=Object(j.a)(c,2),u=i[0],O=i[1];return Object(r.useEffect)((function(){function e(){return t.apply(this,arguments)}function t(){return t=Object(o.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:M().then((function(e){if(e){var t=e.data,n=e.error,r=e.status,a=t&&!n&&200===r;console.log(a?"User exists in DB.":"User does not exist in DB.");var c=Object(s.a)(Object(s.a)({},p.auth.session()),{},{isCreated:a});O(c)}})).finally((function(){a(!1)}));case 1:case"end":return e.stop()}}),e)}))),t.apply(this,arguments)}e(),p.auth.onAuthStateChange(function(){var t=Object(o.a)(l.a.mark((function t(n,r){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e();case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}),[]),n?Object(y.jsx)(d.a,{}):Object(y.jsx)(y.Fragment,{children:u?u.isCreated?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(w,{session:u}),Object(y.jsxs)("div",{className:"container",children:[Object(y.jsx)(C,{}),Object(y.jsx)("main",{children:Object(y.jsxs)(b.d,{children:[Object(y.jsx)(b.b,{path:"/",exact:!0,children:Object(y.jsx)(W,{})}),Object(y.jsx)(b.b,{path:x,exact:!0,children:Object(y.jsx)(Z,{})}),Object(y.jsx)(b.b,{path:h,exact:!0,children:Object(y.jsx)(P,{session:u})}),Object(y.jsx)(b.a,{to:"/"})]})})]})]}):Object(y.jsx)(H,{}):Object(y.jsx)(q,{})})}var K=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,223)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};i.a.render(Object(y.jsx)(a.a.StrictMode,{children:Object(y.jsx)(k.a,{children:Object(y.jsx)(V,{})})}),document.getElementById("root")),K()},70:function(e,t,n){}},[[186,1,2]]]);
//# sourceMappingURL=main.060fa4c0.chunk.js.map